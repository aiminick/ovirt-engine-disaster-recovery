{
  "name": "Ovirt-engine-disaster-recovery",
  "tagline": "",
  "body": "# README -  oVirt Engine Disaster Recovery #\r\n\r\nThis is a web application that uses Java, oVirt API and PostgreSQL to perform the task needed to for oVirt's Disaster Recovery. \r\n\r\n\r\n\r\n## Assumptions ##\r\n\r\n* Every master Storage domain for each Data Center has been replicated from site A to site B.\r\n* There is an exact copy of the RHEV-M/Engine available to run on site B, in case of DR.  \r\n* Please refer to next section. \r\n \r\n\r\n## How does this work ? ##\r\n\r\n* This project try to implement Approach #2, presented on this slides DevConf.cz - 2014 [Disaster Recovery Strategies Using oVirt's new Storage Connection Management Features](http://www.slideshare.net/AllonMureinik/dev-conf-ovirt-dr)\r\n* The goal was to use 100% the API, during the entire process, but we needed to interact directly with the database due to current pending feature to edit - Storage Connection, without setting the Storage Domains in maintenence mode. - Reference [Updating a Storage Connection](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Virtualization/3.5/html/Technical_Guide/sect-Methods6.html)\r\n\r\n## Installation Guide ##\r\n\r\n### Requirements\r\n\r\n* Centos/RHEL 7.x -> latest version __(minimal installation)__\r\n* Java Oracle 8, *needs testing with OpenJDK*\r\n* MariaDB/MySQL 5.x (for storing application configuration and parameters) \r\n* Play Framework 1.4, *we need some help freeing the app, from this framework, we needed to deliver the app fast for a customer, so we used this framework.* [Play Framework](https://www.playframework.com/download)\r\n\r\n### Preparing OS \r\n\r\n* Always update your OS packages, then install required. \r\n\r\n```\r\nyum update -y \r\n```\r\n* Installing Java Oracle 1.8 \r\n\r\nFor RHEL 7.x\r\n\r\n```\r\nsubscription-manager repos --enable rhel-7-server-thirdparty-oracle-java-rpms ; \\\r\nyum install java-1.8.0-oracle -y\r\n```\r\n\r\nFor Centos 7.x\r\n\r\nDownload from: [Java 1.8 Oracle](http://www.oracle.com/technetwork/java/javase/downloads/index.html) \r\n\r\n```\r\nyum localinstall jre-8u91-linux-x64.rpm -y\r\n```\r\n\r\nVerify Java version\r\n\r\n```\r\n[root@localhost ~]# java -version\r\njava version \"1.8.0_XX\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_XX)\r\nJava HotSpot(TM) 64-Bit Server VM (build XX, mixed mode)\r\n```\r\n\r\nOpen port TCP 9000\r\n\r\n```\r\nfirewall-cmd --add-port=9000/tcp --permanent\r\nsystemctl restart firewalld\r\n\r\n```\r\n\r\n### Installing oVirt Engine Disaster Recovery from RPM\r\n\r\n* Download YUM REPO\r\n\r\n```\r\ncd /etc/yum.repos.d/\r\ncurl -O http://supp01.i-t-m.com/.repo\r\n\r\n```\r\nThis is a temporal repository and can/will be changed in the future !\r\n\r\n* Install RPMs\r\n\r\n```\r\nyum install -y ovirt-engine-disaster-recovery-app\r\n```  \r\n\r\n### Configure Database\r\n\r\n* Start/Enable MariaDB\r\n\r\n```\r\nsystemctl enable mariadb\r\nsystemctl start mariadb\r\n```\r\n\r\n* MariaDB Secure Installation\r\n\r\n```\r\nmysql_secure_installation\r\n```\r\n* Create DB\r\n\r\n```\r\nmysqladmin create ovirtenginedr -p\r\n```\r\n\r\n* Import Initial DB\r\n  * from RPM\r\n  ```\r\n  mysql -u root -p ovirtenginedr < /usr/share/doc/ovirt-engine-disaster-recovery-${VERSION}-${RELEASE}/ovirt-engine-disaster-recovery.sql\r\n  ```\r\n  * from SOURCE\r\n  ```\r\n  mysql -u root -p ovirtenginedr < ~/ovirt-engine-disaster-recovery/docs/ovirt-engine-disaster-recovery.sql\r\n  ```\r\n\r\n* Create DB User\r\n\r\n```\r\nmysql -u root -p\r\n\r\nMariaDB [(none)]> CREATE USER 'ovirtdr'@'localhost' IDENTIFIED BY 'YOURPASSWOR-HERE';\r\nMariaDB [(none)]> GRANT ALL PRIVILEGES ON ovirtenginedr.* TO 'ovirtdr'@'localhost';\r\n\r\n```\r\n\r\n## Application Configuration\r\n\r\n* Configure Database Parameters\r\n\r\nEdit configuration file: __/etc/ovirt-engine-disaster-recovery/ovirt-engine-disaster-recovery.conf__\r\n\r\n```\r\n# Change Values on Line 91 for MariaDB\r\n\r\n90 # To connect to a local MySQL5 database, use:\r\n91 db=mysql://ovirtdr:YOURPASSWOR-HERE@localhost:3306/ovirtenginedr\r\n\r\n# Change Value on Line 215 for PostgreSQL\r\n\r\n215 ovirt.db.host = YOUR-RHEV-M-HOSTNAME-HERE # Example: rhevm.internal.itm.gt\r\n216 ovirt.db.port = 5432\r\n217 ovirt.db.user = engine\r\n218 ovirt.db.password = YOUR-PGSQL-ENGINE-PASSWORD-HERE\r\n219 ovirt.db.name = engine\r\n\r\n```\r\n\r\n# Service Administration\r\n\r\n## Systemctl Administration\r\n\r\n* Start\r\n\r\n```\r\nsystemctl start ovirt-engine-disaster-recovery\r\n\r\n```\r\n\r\n* Status\r\n\r\n```\r\nsystemctl status ovirt-engine-disaster-recovery\r\n\r\n```\r\n\r\n* Stop\r\n\r\n```\r\nsystemctl stop ovirt-engine-disaster-recovery\r\n\r\n```\r\n\r\n\r\n## LOG FILE\r\n```\r\n/var/log/ovirt-engine-disaster-recovery/application.log\r\n```\r\n\r\nYou should monitor this file, for Java exceptions or SQL errors.\r\n\r\nOne common error is supplying wrong credentials to MariaDB.\r\n\r\n### Installing oVirt Engine Disaster Recovery from SOURCE\r\n* Build Deps\r\n  * wget\r\n  * git\r\n  * unzip\r\n  * bower\r\n  * epel-release\r\n  * mariadb-server\r\n\r\n* Install Deps\r\n\r\n```\r\nsudo yum install wget -y\r\nsudo yum install git -y\r\nsudo yum install unzip -y\r\nsudo yum install epel-release -y\r\nsudo yum install npm -y\r\nsudo yum install mariadb-server -y\r\n```\r\n* Install bower\r\n```\r\nnpm install bower\r\n```\r\n\r\n* Install Java 8\r\n```\r\nwget --no-cookies \\\r\n--no-check-certificate \\\r\n--header \"Cookie: oraclelicense=accept-securebackup-cookie\" \\\r\n\"http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.rpm\" \\\r\n-O jdk-8u101-linux-x64.rpm\r\n\r\nsudo rpm -Uvh jdk-8u101-linux-x64.rpm\r\n```\r\n\r\n* Download Play Framework\r\n```\r\nwget https://downloads.typesafe.com/play/1.4.2/play-1.4.2.zip\r\n```\r\n\r\n* Unzip Play Framework\r\n```\r\nunzip play-1.4.2.zip\r\n```\r\n\r\n* Clone REPO\r\n```\r\ngit clone https://github.com/xandradx/ovirt-engine-disaster-recovery.git\r\n```\r\n\r\n* Log configuration\r\n```\r\nsed -i 's/^log4j.appender.Rolling.File=.*/log4j.appender.Rolling.File=\\/var\\/log\\/ovirt-engine-disaster-recovery\\/application.log/g' ~/ovirt-engine-disaster-recovery/conf/log4j.properties\r\nsudo mkdir /var/log/ovirt-engine-disaster-recovery/\r\nsudo chown $USER:$USER /var/log/ovirt-engine-disaster-recovery/\r\n```\r\n\r\n* Install patternfly\r\n\r\n```\r\ncd ~/ovirt-engine-disaster-recovery/\r\n~/node_modules/bower/bin/bower install\r\n```\r\n\r\n* Install dependencies Java ( Play Framework )\r\n```\r\ncd ~\r\n~/play-1.4.2/play deps ovirt-engine-disaster-recovery\r\n```\r\n\r\n* Add firewall rule\r\n```\r\nsudo firewall-cmd --add-port=9000/tcp\r\nsudo firewall-cmd --add-port=9000/tcp --permanent\r\n```\r\n\r\n* [Configure Database]\r\n[Configure Database]: https://github.com/xandradx/ovirt-engine-disaster-recovery#configure-database\r\n\r\n* Create Symbolic Link for configuration\r\n```\r\nsudo mkdir /etc/ovirt-engine-disaster-recovery\r\nsudo ln -s ~/ovirt-engine-disaster-recovery/conf/application.conf /etc/ovirt-engine-disaster-recovery/ovirt-engine-disaster-recovery.conf\r\n```\r\n  * [Configure App]\r\n  [Configure App]: https://github.com/xandradx/ovirt-engine-disaster-recovery#application-configuration\r\n\r\n* Starting Service\r\n```\r\n~/play-1.4.2/play start ovirt-engine-disaster-recovery\r\n```\r\n\r\n## Next Step\r\n\r\n* [Administration Guide](https://docs.google.com/document/d/1THvgPaQk_GvbqbvtTXCaw816DgcBHmhBctGwoJBJ7xk/pub)\r\n* [Spanish Videos](https://www.youtube.com/watch?v=ef_ZmgixzJM&list=PLgtS4_6D5_KUQGnLpaTVZkHJScKcLUZoX&index=2)\r\n* [English Videos](coming soon)\r\n\r\n## Who do I talk to? ##\r\n\r\n* [Chocomango](http://chocomango.net) - Jos√© Eduardo Andrade Escobar <jandrad@chocomando.net> \r\n* [ITM](http://itm.gt) - Jorge Luis Andrade Escobar <jandrade@itm.gt> (yes, we are brothers)\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}