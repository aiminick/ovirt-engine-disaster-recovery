#{extends 'main.html' /}
#{set title:messages.get('dashboard.title') /}

<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">&{'dashboard.datacenters'}</h3>
            </div>
            <table class="table table-striped" id="table_data_centers">
                <thead>
                <tr>
                    <th>#</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Username</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td colspan="2">Larry the Bird</td>
                    <td>@twitter</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 sidebar-pf sidebar-pf-right">
        <div class="sidebar-header sidebar-header-bleed-left sidebar-header-bleed-right">
            <div class="actions pull-right" id="actions_bar">

            </div>
            <h2 class="h5">DRP</h2>
        </div>
        <ul class="list-group" id="operation_list">

        </ul>
    </div>
</div>




<script>

    function setStartButton() {
       var html = '<button onclick="startOperation()" class="btn btn-small btn-primary" id="button_start">Start</button>';
       $("#actions_bar").html(html);
    }

    function setLoading() {
       var html = '<div class="spinner"></div>';
       $("#actions_bar").html(html);
    }

    function clearActions() {
       $("#actions_bar").html("");
    }

    function startOperation() {

        if ("WebSocket" in window) {
            var operationList = $("#operation_list");
            operationList.html("");

            setLoading();

            var socket = new WebSocket("@@{WSDisasterRecovery.startOperation()}");

	        socket.onmessage = function(msg){
	            addMessage("Message", msg.data);
	        };

	        socket.onclose = function() {
	            clearActions();
	        };
        } else {
        }

    }

    function addMessage(title, message) {
        var operationList = $("#operation_list");
        var cellHtml = "";
        cellHtml += '<li class="list-group-item">';
        //cellHtml += '<h3 class="list-group-item-heading">'+title+'</h3>';
        cellHtml += '<p class="list-group-item-text">'+message+'</p>';
        cellHtml += '</li>';

        operationList.append(cellHtml);
    }

    setStartButton();

</script>
